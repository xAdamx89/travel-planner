<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Weather Checker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    <style>
        body, html {
            margin: 0;
            height: 100%;
        }
        #main-container {
            display: flex;
            height: 100vh;
        }
        #sidebar-container {
            flex-shrink: 0;
        }
        #weather-content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
        }
        #weatherResults .card {
            width: 100%;
        }
    </style>
</head>
<body>

<div id="main-container">
    <!-- Sidebar -->
    <div id="sidebar-container"></div>

    <!-- G≈Ç√≥wna zawarto≈õƒá -->
    <div id="weather-content">
        <h3>üå§Ô∏è Prognoza pogody na 7 dni</h3>

        <div class="mb-3" style="max-width: 400px;">
            <input type="text" id="cityInput" class="form-control" placeholder="Wpisz miasto">
        </div>

        <button id="checkWeatherBtn" class="btn btn-primary mb-3">Sprawd≈∫ pogodƒô</button>

        <div id="weatherResults" style="max-width: 600px;"></div>
    </div>
</div>

<script type="module">
    const WEATHER_API_KEY = "93804964d91b0bb37fb9dd91fe5f92e3";

    async function fetchWeather(city) {
        try {
            const geoRes = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(city)}&limit=1&appid=${WEATHER_API_KEY}`);
            const geoData = await geoRes.json();
            if (!geoData.length) throw new Error("Nie znaleziono miasta");

            const { lat, lon } = geoData[0];

            const res = await fetch(`https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lon}&exclude=minutely,hourly,alerts&units=metric&lang=pl&appid=${WEATHER_API_KEY}`);
            const data = await res.json();
            return data.daily;
        } catch (err) {
            console.error(err);
            alert(err.message);
            return [];
        }
    }

    function renderWeather(daily) {
        const container = document.getElementById("weatherResults");
        container.innerHTML = "";

        daily.forEach(day => {
            const date = new Date(day.dt * 1000);
            container.innerHTML += `
                <div class="card mb-2">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <strong>${date.toLocaleDateString('pl-PL', { weekday: 'long', day: 'numeric', month: 'numeric' })}</strong>
                            <div>${day.weather[0].description}</div>
                        </div>
                        <div>
                            üå°Ô∏è ${Math.round(day.temp.day)}¬∞C
                        </div>
                    </div>
                </div>
            `;
        });
    }

    document.getElementById("checkWeatherBtn").addEventListener("click", async () => {
        const city = document.getElementById("cityInput").value.trim();
        if (!city) return alert("Podaj miasto");
        const daily = await fetchWeather(city);
        renderWeather(daily);
    });

    // Sidebar
    fetch("partials/sidebar.html")
        .then(r => r.text())
        .then(html => document.getElementById("sidebar-container").innerHTML = html);
</script>
</body>
</html>
