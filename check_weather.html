<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Weather Checker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    <style>
        body, html {
            margin: 0;
            height: 100%;
        }
        #main-container {
            display: flex;
            height: 100vh;
        }
        #sidebar-container {
            flex-shrink: 0;
        }
        #weather-content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
        }
        #weatherResults .card {
            width: 100%;
        }
    </style>
</head>
<body>

<div id="main-container">
    <!-- Sidebar -->
    <div id="sidebar-container"></div>

    <!-- G≈Ç√≥wna zawarto≈õƒá -->
    <div id="weather-content">
        <h3>üå§Ô∏è Prognoza pogody na 7 dni</h3>

        <div class="mb-3" style="max-width: 400px;">
            <input type="text" id="cityInput" class="form-control" placeholder="Wpisz miasto">
        </div>

        <div class="mb-3" style="max-width: 400px;">
            <input type="date" id="dateInput" class="form-control">
        </div>

        <button id="checkWeatherBtn" class="btn btn-primary mb-3">
            Sprawd≈∫ pogodƒô
        </button>

        <div id="weatherResults" style="max-width: 600px;"></div>
    </div>
</div>

<script type="module">
const WEATHER_API_KEY = "93804964d91b0bb37fb9dd91fe5f92e3";

/* ===== DATE LIMITS FOR FREE API ===== */
const dateInput = document.getElementById("dateInput");

const today = new Date();
const maxDate = new Date();
maxDate.setDate(today.getDate() + 5);

// format YYYY-MM-DD
const formatDate = d => d.toISOString().split("T")[0];

dateInput.min = formatDate(today);
dateInput.max = formatDate(maxDate);
dateInput.value = formatDate(today);



/* ===== FETCH FORECAST 5-DAY ===== */
async function fetchForecast(city) {
    const res = await fetch(
        `https://api.openweathermap.org/data/2.5/forecast?q=${encodeURIComponent(city)}&units=metric&lang=pl&appid=${WEATHER_API_KEY}`
    );

    if (!res.ok) {
        throw new Error("B≈ÇƒÖd pobierania prognozy");
    }

    return await res.json();
}

/* ===== FILTER BY DATE ===== */
function getForecastForDate(forecastData, selectedDate) {
    return forecastData.list.filter(item =>
        item.dt_txt.startsWith(selectedDate)
    );
}

/* ===== RENDER RESULT ===== */
function renderWeather(city, date, forecasts) {
    const container = document.getElementById("weatherResults");
    container.innerHTML = "";

    if (forecasts.length === 0) {
        container.innerHTML = `<div class="alert alert-warning">
            Brak danych pogodowych dla tego dnia (API obs≈Çuguje ~5 dni).
        </div>`;
        return;
    }

    forecasts.forEach(item => {
        container.innerHTML += `
            <div class="card mb-2">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div>
                        <strong>${new Date(item.dt * 1000)
                            .toLocaleTimeString("pl-PL", { hour: "2-digit", minute: "2-digit" })}</strong>
                        <div>${item.weather[0].description}</div>
                    </div>
                    <div>
                        üå°Ô∏è ${Math.round(item.main.temp)}¬∞C
                    </div>
                </div>
            </div>
        `;
    });
}

/* ===== BUTTON ===== */
document.getElementById("checkWeatherBtn").addEventListener("click", async () => {
    const city = document.getElementById("cityInput").value.trim();
    const date = document.getElementById("dateInput").value;

    if (!city || !date) {
        alert("Podaj miasto i datƒô");
        return;
    }

    try {
        const forecastData = await fetchForecast(city);
        const dayForecast = getForecastForDate(forecastData, date);
        renderWeather(city, date, dayForecast);
    } catch (err) {
        alert(err.message);
        console.error(err);
    }
});

/* ===== SIDEBAR ===== */
fetch("partials/sidebar.html")
    .then(r => r.text())
    .then(html => document.getElementById("sidebar-container").innerHTML = html);
</script>
</body>
</html>
