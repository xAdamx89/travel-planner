<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Travel Planner</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            margin: 0;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            background-color: #3b2a6f;
            color: white;
            height: 100vh;
            width: 220px;
            padding: 20px;
        }

        .sidebar h4 {
            margin-bottom: 30px;
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
        }

        .sidebar li {
            padding: 10px 0;
            cursor: pointer;
            opacity: 0.9;
        }

        .sidebar li.active {
            font-weight: bold;
            opacity: 1;
        }

        /* Calendar layout */
        .calendar {
            padding: 20px;
            overflow-x: auto;
        }

        .calendar-header {
            display: grid;
            grid-template-columns: 80px repeat(6, 1fr);
            font-weight: bold;
            margin-bottom: 10px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: 80px repeat(6, 1fr);
            grid-template-rows: repeat(8, 80px);
        }

        .time {
            border-top: 1px solid #ddd;
            padding: 5px;
            font-size: 0.85rem;
            color: #555;
        }

        .cell {
            border: 1px solid #eee;
            position: relative;
            cursor: pointer;
            transition: background-color 0.2s ease, box-shadow 0.2s ease;
        }

        .cell:hover {
            background-color: #f0f4ff;
            box-shadow: inset 0 0 0 2px #a0b4ff;
        }

        .event {
            position: absolute;
            inset: 5px;
            border-radius: 6px;
            padding: 8px;
            color: white;
            font-size: 0.8rem;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .event:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .calendar-header div {
            text-align: center;
            font-weight: 600;
        }

        .blue { background: #1ea7fd; }
        .pink { background: #ff4da6; }
        .orange { background: #f4a000; }
        .purple { background: #a200ff; }
        .green { background: #00b3a4; }

        /* Color picker buttons */
        .btn-check:checked + label {
            transform: scale(1.2);
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.2);
        }

        #colorBlue + label:hover,
        #colorBlue:checked + label {
            background-color: #1ea7fd;
        }

        #colorPink + label:hover,
        #colorPink:checked + label {
            background-color: #ff4da6;
        }

        #colorOrange + label:hover,
        #colorOrange:checked + label {
            background-color: #f4a000;
        }

        #colorPurple + label:hover,
        #colorPurple:checked + label {
            background-color: #a200ff;
        }

        #colorGreen + label:hover,
        #colorGreen:checked + label {
            background-color: #00b3a4;
        }

        /* Modal styling */
        .modal-header.bg-primary {
            background: linear-gradient(135deg, #3b2a6f 0%, #1ea7fd 100%) !important;
        }

        /* Empty cell indicator */
        .cell:empty::after {
            content: "+";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ddd;
            font-size: 1.5rem;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .cell:empty:hover::after {
            opacity: 1;
        }
    </style>
</head>
<body>

<div class="d-flex">
    <div class="sidebar">
        <h4>üìÖ Planner</h4>
        <ul>
            <li>Calendar</li>
            <li>Day</li>
            <li>Agenda</li>
            <li class="active">Schedule</li>
            <li>Trips</li>
            <li>Settings</li>
        </ul>
    </div>

    <div class="flex-grow-1 p-3">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <button id="prevWeek" class="btn btn-outline-secondary btn-sm">‚Üê Previous</button>
            <h5 id="currentWeek" class="mb-0"></h5>
            <button id="nextWeek" class="btn btn-outline-secondary btn-sm">Next ‚Üí</button>
        </div>

        <div class="calendar flex-grow-1">
            <div id="calendar-header" class="calendar-header"></div>
            <div id="calendar-grid" class="calendar-grid"></div>
        </div>
    </div>
</div>

<div class="modal fade" id="tripModal" tabindex="-1" aria-labelledby="tripModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="tripModalLabel">‚úàÔ∏è Dodaj wycieczkƒô</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Zamknij"></button>
            </div>
            <div class="modal-body">
                <form id="tripForm">
                    <input type="hidden" id="tripDate" name="date">
                    <input type="hidden" id="tripHour" name="hour">
                    <input type="hidden" id="editMode" value="0">
                    <input type="hidden" id="eventIndex" value="">

                    <div class="mb-3">
                        <label for="tripCountry" class="form-label">üåç Kraj</label>
                        <input type="text" class="form-control" id="tripCountry" placeholder="np. W≈Çochy" required>
                    </div>

                    <div class="mb-3">
                        <label for="tripCity" class="form-label">üèôÔ∏è Miasto</label>
                        <input type="text" class="form-control" id="tripCity" placeholder="np. Rzym" required>
                    </div>

                    <div class="mb-3">
                        <label for="tripCost" class="form-label">üí∞ Koszt wycieczki (PLN)</label>
                        <input type="number" class="form-control" id="tripCost" placeholder="np. 2500" min="0" step="0.01">
                    </div>

                    <div class="mb-3">
                        <label for="tripWeather" class="form-label">üå§Ô∏è Pogoda</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="tripWeather" placeholder="≈Åadowanie..." readonly>
                            <span class="input-group-text bg-light">
                                <span id="weatherIcon">üîÑ</span>
                            </span>
                        </div>
                        <small class="text-muted">Pogoda zostanie pobrana automatycznie</small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">üé® Kolor wydarzenia</label>
                        <div class="d-flex gap-2">
                            <input type="radio" class="btn-check" name="tripColor" id="colorBlue" value="blue" checked>
                            <label class="btn btn-outline-primary rounded-circle p-3" for="colorBlue"></label>

                            <input type="radio" class="btn-check" name="tripColor" id="colorPink" value="pink">
                            <label class="btn btn-outline-danger rounded-circle p-3" for="colorPink" style="border-color: #ff4da6;"></label>

                            <input type="radio" class="btn-check" name="tripColor" id="colorOrange" value="orange">
                            <label class="btn btn-outline-warning rounded-circle p-3" for="colorOrange"></label>

                            <input type="radio" class="btn-check" name="tripColor" id="colorPurple" value="purple">
                            <label class="btn rounded-circle p-3" for="colorPurple" style="border: 2px solid #a200ff;"></label>

                            <input type="radio" class="btn-check" name="tripColor" id="colorGreen" value="green">
                            <label class="btn btn-outline-success rounded-circle p-3" for="colorGreen" style="border-color: #00b3a4;"></label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Anuluj</button>
                <button type="button" class="btn btn-danger" id="deleteTripBtn" style="display: none;">üóëÔ∏è Usu≈Ñ</button>
                <button type="button" class="btn btn-primary" id="saveTripBtn">üíæ Zapisz wycieczkƒô</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    /***************************
     * DATE LOGIC
     ***************************/

    let currentDate = new Date();

    const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

    function getMonday(date) {
        const d = new Date(date);
        const day = d.getDay();
        const diff = d.getDate() - day + (day === 0 ? -6 : 1);
        return new Date(d.setDate(diff));
    }

    function formatDate(date) {
        return date.toLocaleDateString("pl-PL", {
            day: "2-digit",
            month: "2-digit"
        });
    }

    /***************************
     * EVENTS DATA
     ***************************/

    const eventsData = {
        "2024-01-15": {
            "9:00": [{ type: "blue", country: "W≈Çochy", city: "Rzym", cost: 1800, weather: "18¬∞C, s≈Çonecznie" }],
            "10:00": [{ type: "pink", country: "W≈Çochy", city: "Rzym", cost: 200, weather: "19¬∞C, chmury" }]
        },
        "2024-01-16": {
            "9:00": [{ type: "orange", country: "Hiszpania", city: "Barcelona", cost: 1200, weather: "21¬∞C, s≈Çonecznie" }],
            "11:00": [{ type: "purple", country: "Francja", city: "Pary≈º", cost: 150, weather: "17¬∞C, deszcz" }],
            "13:00": [{ type: "green", country: "Grecja", city: "Santorini", cost: 900, weather: "24¬∞C, s≈Çonecznie" }]
        }
    };

    function getEventsForDate(dateStr, hour) {
        if (eventsData[dateStr] && eventsData[dateStr][hour]) {
            return eventsData[dateStr][hour];
        }
        return [];
    }

    /***************************
     * RENDER FUNCTIONS
     ***************************/

    function renderHeader() {
        const header = document.getElementById("calendar-header");
        if (!header) return;

        header.innerHTML = "<div></div>";

        const monday = getMonday(currentDate);

        days.forEach((day, index) => {
            const date = new Date(monday);
            date.setDate(monday.getDate() + index);

            header.innerHTML += `
                <div class="text-center">
                    ${day}<br>
                    <small>${formatDate(date)}</small>
                </div>
            `;
        });

        const saturday = new Date(monday);
        saturday.setDate(monday.getDate() + 5);

        const currentWeekElement = document.getElementById("currentWeek");
        if (currentWeekElement) {
            currentWeekElement.innerText = `${formatDate(monday)} ‚Äì ${formatDate(saturday)}`;
        }
    }

    function renderGrid() {
        const grid = document.getElementById("calendar-grid");
        if (!grid) return;

        grid.innerHTML = "";

        const hours = ["9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00", "16:00"];
        const monday = getMonday(currentDate);

        hours.forEach(hour => {
            grid.innerHTML += `<div class="time">${hour}</div>`;

            for (let i = 0; i < 6; i++) {
                const date = new Date(monday);
                date.setDate(monday.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];

                const events = getEventsForDate(dateStr, hour);
                let eventsHtml = "";

                events.forEach((event, index) => {
                    const displayText = `
                        ${event.city}<br>
                        ${event.country}
                        ${event.cost ? `<br>${event.cost} PLN` : ''}
                    `;
                    eventsHtml += `<div class="event ${event.type}" data-event-index="${index}" title="${event.weather || 'Pogoda: --'}">${displayText}</div>`;
                });

                grid.innerHTML += `
                    <div class="cell"
                         data-date="${dateStr}"
                         data-hour="${hour}">
                        ${eventsHtml}
                    </div>
                `;
            }
        });
    }

    function renderCalendar() {
        renderHeader();
        renderGrid();
    }

    /***************************
     * WEEK NAVIGATION
     ***************************/

    function attachWeekButtons() {
        const prevButton = document.getElementById("prevWeek");
        const nextButton = document.getElementById("nextWeek");

        if (prevButton) {
            prevButton.addEventListener("click", () => {
                currentDate.setDate(currentDate.getDate() - 7);
                renderCalendar();
                attachCellClickHandlers();
            });
        }

        if (nextButton) {
            nextButton.addEventListener("click", () => {
                currentDate.setDate(currentDate.getDate() + 7);
                renderCalendar();
                attachCellClickHandlers();
            });
        }
    }

    /***************************
     * MODAL & TRIP MANAGEMENT
     ***************************/

    let tripModal = null;
    let isEditMode = false;
    let editDate = '';
    let editHour = '';
    let editIndex = -1;

    function attachCellClickHandlers() {
        const cells = document.querySelectorAll(".cell");

        cells.forEach(cell => {
            cell.addEventListener("click", (e) => {
                if (e.target.classList.contains("event")) {
                    handleEventClick(e.target);
                    return;
                }
                handleCellClick(cell);
            });
        });
    }

    function handleCellClick(cell) {
        const date = cell.dataset.date;
        const hour = cell.dataset.hour;
        openModalForAdd(date, hour);
    }

    function handleEventClick(eventEl) {
        const cell = eventEl.closest('.cell');
        editDate = cell.dataset.date;
        editHour = cell.dataset.hour;
        editIndex = parseInt(eventEl.dataset.eventIndex);

        const eventData = getEventData(editDate, editHour, editIndex);
        if (!eventData) return;

        openModalForEdit(eventData);
    }

    function simulateWeatherFetch() {
        setTimeout(() => {
            const weatherIcon = document.getElementById("weatherIcon");
            const weatherInput = document.getElementById("tripWeather");
            weatherInput.value = "-- ¬∞C (uzupe≈Çnij p√≥≈∫niej)";
            weatherIcon.textContent = "üå°Ô∏è";
        }, 500);
    }

    function getEventData(dateStr, hour, index) {
        if (eventsData[dateStr] && eventsData[dateStr][hour] && eventsData[dateStr][hour][index]) {
            return eventsData[dateStr][hour][index];
        }
        return null;
    }

    function openModalForAdd(date, hour) {
        isEditMode = false;
        document.getElementById("editMode").value = "0";
        document.getElementById("eventIndex").value = "";
        document.getElementById("deleteTripBtn").style.display = "none";

        document.getElementById("tripForm").reset();
        document.getElementById("tripDate").value = date;
        document.getElementById("tripHour").value = hour;

        document.getElementById("tripWeather").value = "≈Åadowanie...";
        document.getElementById("weatherIcon").textContent = "üîÑ";

        const formattedDate = new Date(date).toLocaleDateString("pl-PL", {
            weekday: 'long',
            day: 'numeric',
            month: 'long',
            year: 'numeric'
        });
        document.getElementById("tripModalLabel").textContent =
            `‚úàÔ∏è Dodaj wycieczkƒô - ${formattedDate}, ${hour}`;

        if (!tripModal) {
            tripModal = new bootstrap.Modal(document.getElementById("tripModal"));
        }
        tripModal.show();

        simulateWeatherFetch();
    }

    function openModalForEdit(eventData) {
        isEditMode = true;
        document.getElementById("editMode").value = "1";
        document.getElementById("eventIndex").value = editIndex;
        document.getElementById("deleteTripBtn").style.display = "inline-block";

        document.getElementById("tripDate").value = editDate;
        document.getElementById("tripHour").value = editHour;

        document.getElementById("tripCountry").value = eventData.country;
        document.getElementById("tripCity").value = eventData.city;
        document.getElementById("tripCost").value = eventData.cost || "";
        document.getElementById("tripWeather").value = eventData.weather || "";

        document.querySelector(`input[name="tripColor"][value="${eventData.type}"]`).checked = true;

        const formattedDate = new Date(editDate).toLocaleDateString("pl-PL", {
            weekday: 'long',
            day: 'numeric',
            month: 'long',
            year: 'numeric'
        });
        document.getElementById("tripModalLabel").textContent =
            `‚úàÔ∏è Edytuj wycieczkƒô - ${formattedDate}, ${editHour}`;

        if (!tripModal) {
            tripModal = new bootstrap.Modal(document.getElementById("tripModal"));
        }
        tripModal.show();
    }

    function attachSaveButton() {
        const saveBtn = document.getElementById("saveTripBtn");
        const deleteBtn = document.getElementById("deleteTripBtn");

        if (saveBtn) {
            saveBtn.addEventListener("click", saveTrip);
        }

        if (deleteBtn) {
            deleteBtn.addEventListener("click", deleteTrip);
        }
    }

    function saveTrip() {
        const date = document.getElementById("tripDate").value;
        const hour = document.getElementById("tripHour").value;
        const country = document.getElementById("tripCountry").value.trim();
        const city = document.getElementById("tripCity").value.trim();
        const cost = document.getElementById("tripCost").value;
        const weather = document.getElementById("tripWeather").value;
        const color = document.querySelector('input[name="tripColor"]:checked').value;

        if (!country || !city) {
            alert("Proszƒô wype≈Çniƒá kraj i miasto!");
            return;
        }

        const eventData = {
            type: color,
            country: country,
            city: city,
            cost: cost ? parseFloat(cost) : 0,
            weather: weather
        };

        if (isEditMode) {
            if (!eventsData[date]) eventsData[date] = {};
            if (!eventsData[date][hour]) eventsData[date][hour] = [];
            eventsData[date][hour][editIndex] = eventData;
            showToast(`Wycieczka do ${city}, ${country} zosta≈Ça zaktualizowana!`);
        } else {
            if (!eventsData[date]) eventsData[date] = {};
            if (!eventsData[date][hour]) eventsData[date][hour] = [];
            eventsData[date][hour].push(eventData);
            showToast(`Wycieczka do ${city}, ${country} zosta≈Ça dodana!`);
        }

        saveEventsToStorage();
        tripModal.hide();
        renderCalendar();
        attachCellClickHandlers();
        attachSaveButton();
    }

    function deleteTrip() {
        if (confirm("Na pewno usunƒÖƒá tƒô wycieczkƒô?")) {
            if (eventsData[editDate] && eventsData[editDate][editHour]) {
                eventsData[editDate][editHour].splice(editIndex, 1);
                if (eventsData[editDate][editHour].length === 0) {
                    delete eventsData[editDate][editHour];
                }
                if (Object.keys(eventsData[editDate]).length === 0) {
                    delete eventsData[editDate];
                }
            }

            saveEventsToStorage();
            tripModal.hide();
            renderCalendar();
            attachCellClickHandlers();
            attachSaveButton();

            showToast("Wycieczka zosta≈Ça usuniƒôta!");
        }
    }

    /***************************
     * LOCAL STORAGE
     ***************************/

    function saveEventsToStorage() {
        localStorage.setItem("travelPlannerEvents", JSON.stringify(eventsData));
    }

    function loadEventsFromStorage() {
        const stored = localStorage.getItem("travelPlannerEvents");
        if (stored) {
            const parsed = JSON.parse(stored);
            Object.assign(eventsData, parsed);
        }
    }

    /***************************
     * TOAST NOTIFICATIONS
     ***************************/

    function showToast(message) {
        let toastContainer = document.getElementById("toast-container");
        if (!toastContainer) {
            toastContainer = document.createElement("div");
            toastContainer.id = "toast-container";
            toastContainer.className = "toast-container position-fixed bottom-0 end-0 p-3";
            document.body.appendChild(toastContainer);
        }

        const toastId = "toast-" + Date.now();
        const toastHtml = `
            <div id="${toastId}" class="toast align-items-center text-bg-success border-0" role="alert">
                <div class="d-flex">
                    <div class="toast-body">
                        ‚úÖ ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            </div>
        `;

        toastContainer.insertAdjacentHTML("beforeend", toastHtml);

        const toastElement = document.getElementById(toastId);
        const toast = new bootstrap.Toast(toastElement, { delay: 3000 });
        toast.show();

        toastElement.addEventListener("hidden.bs.toast", () => {
            toastElement.remove();
        });
    }

    document.addEventListener("DOMContentLoaded", () => {
        loadEventsFromStorage();
        renderCalendar();
        attachWeekButtons();
        attachCellClickHandlers();
        attachSaveButton();
    });
</script>
</body>
</html>